<!-- 
  主题切换按钮嵌入代码
  复制以下代码并粘贴到你的网站 <head> 或 <body> 标签中
-->

<!-- 方式1：使用外部JS文件 -->
<script src="theme-toggle.js"></script>
<script>
  // 初始化主题切换按钮
  new ThemeToggle({
    position: 'bottom-right',  // 位置: 'top-left', 'top-right', 'bottom-left', 'bottom-right', 'fixed'
    offset: { x: 20, y: 20 },  // 偏移量
    size: 50,                   // 按钮大小（像素）
    darkColor: '#1a1a1a',      // 深色模式背景色
    lightColor: '#ffffff'       // 浅色模式背景色
  });
</script>

<!-- 方式2：内联完整代码（一键复制粘贴） -->
<script>
class ThemeToggle {
  constructor(options = {}) {
    this.options = {
      position: options.position || 'bottom-right',
      offset: options.offset || { x: 20, y: 20 },
      size: options.size || 50,
      darkColor: options.darkColor || '#1a1a1a',
      lightColor: options.lightColor || '#ffffff',
      transition: options.transition || '0.3s ease',
      zIndex: options.zIndex || 9999,
      ...options
    };
    this.theme = this.getSavedTheme() || 'light';
    this.init();
  }

  init() {
    this.createButton();
    this.applyTheme(this.theme);
    this.attachEventListeners();
  }

  createButton() {
    this.button = document.createElement('button');
    this.button.id = 'theme-toggle-button';
    this.button.setAttribute('aria-label', '切换主题');
    this.button.innerHTML = this.getIcon(this.theme);
    this.applyButtonStyles();
    document.body.appendChild(this.button);
  }

  applyButtonStyles() {
    const { position, offset, size, zIndex, transition } = this.options;
    const baseStyles = {
      position: 'fixed',
      width: `${size}px`,
      height: `${size}px`,
      borderRadius: '50%',
      border: 'none',
      cursor: 'pointer',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      fontSize: `${size * 0.5}px`,
      boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',
      transition: `all ${transition}`,
      zIndex: zIndex,
      outline: 'none',
      background: this.theme === 'dark' ? '#f0f0f0' : '#2d2d2d',
      color: this.theme === 'dark' ? '#2d2d2d' : '#f0f0f0'
    };
    const positionStyles = this.getPositionStyles(position, offset);
    Object.assign(this.button.style, baseStyles, positionStyles);
  }

  getPositionStyles(position, offset) {
    const positions = {
      'top-left': { top: `${offset.y}px`, left: `${offset.x}px` },
      'top-right': { top: `${offset.y}px`, right: `${offset.x}px` },
      'bottom-left': { bottom: `${offset.y}px`, left: `${offset.x}px` },
      'bottom-right': { bottom: `${offset.y}px`, right: `${offset.x}px` },
      'fixed': { top: '50%', left: '50%', transform: 'translate(-50%, -50%)' }
    };
    return positions[position] || positions['bottom-right'];
  }

  getIcon(theme) {
    if (theme === 'dark') {
      return `<svg width="60%" height="60%" viewBox="0 0 24 24" fill="currentColor">
        <circle cx="12" cy="12" r="5"/>
        <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>`;
    } else {
      return `<svg width="60%" height="60%" viewBox="0 0 24 24" fill="currentColor">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
      </svg>`;
    }
  }

  attachEventListeners() {
    this.button.addEventListener('click', () => this.toggleTheme());
    this.button.addEventListener('mouseenter', () => {
      this.button.style.transform = this.options.position === 'fixed' 
        ? 'translate(-50%, -50%) scale(1.1)' 
        : 'scale(1.1)';
    });
    this.button.addEventListener('mouseleave', () => {
      this.button.style.transform = this.options.position === 'fixed' 
        ? 'translate(-50%, -50%) scale(1)' 
        : 'scale(1)';
    });
  }

  toggleTheme() {
    this.theme = this.theme === 'light' ? 'dark' : 'light';
    this.applyTheme(this.theme);
    this.saveTheme(this.theme);
    this.updateButton();
  }

  applyTheme(theme) {
    const { darkColor, lightColor } = this.options;
    if (theme === 'dark') {
      document.documentElement.style.setProperty('--bg-color', darkColor);
      document.documentElement.style.setProperty('--text-color', lightColor);
      document.documentElement.setAttribute('data-theme', 'dark');
      document.body.style.backgroundColor = darkColor;
      document.body.style.color = lightColor;
    } else {
      document.documentElement.style.setProperty('--bg-color', lightColor);
      document.documentElement.style.setProperty('--text-color', darkColor);
      document.documentElement.setAttribute('data-theme', 'light');
      document.body.style.backgroundColor = lightColor;
      document.body.style.color = darkColor;
    }
    const event = new CustomEvent('themeChanged', { detail: { theme } });
    document.dispatchEvent(event);
  }

  updateButton() {
    this.button.innerHTML = this.getIcon(this.theme);
    this.button.style.background = this.theme === 'dark' ? '#f0f0f0' : '#2d2d2d';
    this.button.style.color = this.theme === 'dark' ? '#2d2d2d' : '#f0f0f0';
  }

  saveTheme(theme) {
    try {
      localStorage.setItem('theme-preference', theme);
    } catch (e) {
      console.warn('无法保存主题偏好:', e);
    }
  }

  getSavedTheme() {
    try {
      return localStorage.getItem('theme-preference');
    } catch (e) {
      return null;
    }
  }

  updatePosition(position, offset) {
    this.options.position = position;
    if (offset) this.options.offset = offset;
    const positionStyles = this.getPositionStyles(position, this.options.offset);
    Object.assign(this.button.style, positionStyles);
  }

  destroy() {
    if (this.button && this.button.parentNode) {
      this.button.parentNode.removeChild(this.button);
    }
  }
}

// 初始化按钮
new ThemeToggle({
  position: 'bottom-right',
  offset: { x: 20, y: 20 },
  size: 50,
  darkColor: '#1a1a1a',
  lightColor: '#ffffff'
});
</script>
